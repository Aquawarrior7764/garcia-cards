<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Redirecting...</title>
  <script>
    (function () {
      const match = window.location.search.match(/[?&]card=([^&]+)/);
      const rawCardParam = match ? decodeURIComponent(match[1]) : null;
      const cardId = rawCardParam ? rawCardParam.split(";")[1] || rawCardParam : null;

      if (cardId) {
        const saved = JSON.parse(localStorage.getItem("scannedCards")) || [];
        const updated = new Set(saved);
        updated.add(cardId);

        localStorage.setItem("scannedCards", JSON.stringify([...updated]));

        // Redirect with full raw string so index.html can handle full value
        window.location.href = `index.html?card=${rawCardParam}`;
      } else {
        window.location.href = "index.html";
      }
    })();
  </script>
</head>
<body>
  <p>Redirecting...</p>
</body>
</html>